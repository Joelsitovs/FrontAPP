import{c as v,d as f,e as S,f as w,g as u,h as y,i as I,j as k}from"./chunk-FWOJAUMH.js";import{Ka as m,Pa as p,Ra as g,f as i,i as l,p as h,u as n,x as s,y as d}from"./chunk-74CKK67D.js";var U=(()=>{class o{authState=new l(null);authState$=this.authState.asObservable();constructor(){let t=localStorage.getItem("token"),r=localStorage.getItem("uid");t&&t.trim()!==""&&r&&this.authState.next({token:t,uid:r})}setUser(t){this.authState.next(t)}clearUser(){this.authState.next(null)}static \u0275fac=function(r){return new(r||o)};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var F=(()=>{class o{router;route;http;authStateService;auth=d(k);constructor(t,r,e,a){this.router=t,this.route=r,this.http=e,this.authStateService=a}saveSession(t,r){localStorage.setItem("token",t),localStorage.setItem("uid",r)}login(t,r){return i(this,null,function*(){try{let{user:e}=yield w(this.auth,t,r);if(!e.emailVerified)return yield u(e),this.router.navigate(["/auth/verify-email"]),Promise.reject("Correo de verificaci\xF3n enviado");let a=yield e.getIdToken();this.saveSession(a,e.uid),this.authStateService.setUser({token:a,uid:e.uid});let c=this.route.snapshot.queryParamMap.get("returnUrl");return this.router.navigate([c||"/"]),Promise.resolve("Usuario logueado")}catch(e){return Promise.reject(this.mapAuthError(e.code))}})}register(t,r){return i(this,null,function*(){try{let{user:e}=yield S(this.auth,t,r);yield u(e);let a=yield e.getIdToken();this.saveSession(a,e.uid),yield h(this.http.post("https://backend-750705921113.europe-southwest1.run.app/assign-role",{}));let c=yield e.getIdToken(!0);localStorage.setItem("token",c),this.authStateService.setUser({token:a,uid:e.uid});let P=this.route.snapshot.queryParamMap.get("returnUrl");return this.router.navigate([P||"/"]),Promise.resolve("Usuario registrado y correo de verificaci\xF3n enviado")}catch(e){throw console.error("Registration error:",e),e}})}logout(){return i(this,null,function*(){try{yield y(this.auth),localStorage.clear(),this.authStateService.clearUser(),this.router.navigate(["/auth/login"])}catch(t){throw console.error("Logout error:",t),t}})}resetPassword(t){return i(this,null,function*(){try{return yield f(this.auth,t),"Correo de recuperaci\xF3n enviado"}catch{return Promise.reject("Error al enviar el correo de restablecimiento de contrase\xF1a")}})}sendEmailVerification(){return i(this,null,function*(){let t=this.auth.currentUser;if(t)try{return yield u(t),"Correo de verificaci\xF3n enviado"}catch{return Promise.reject("Error al enviar el correo de verificaci\xF3n")}return Promise.reject("Usuario no encontrado")})}signInWithGoogle(){return i(this,null,function*(){try{let{user:t}=yield I(this.auth,new v),r=yield t.getIdToken();this.saveSession(r,t.uid),yield h(this.http.post("https://backend-750705921113.europe-southwest1.run.app/assign-role",{}));let e=yield t.getIdToken(!0);localStorage.setItem("token",e),this.authStateService.setUser({token:r,uid:t.uid});let a=this.route.snapshot.queryParamMap.get("returnUrl");return this.router.navigate([a||"/"]),Promise.resolve("Usuario logueado con Google")}catch(t){throw console.error("Google login error:",t),t}})}mapAuthError(t){switch(t){case"auth/user-not-found":return"Usuario no encontrado";case"auth/wrong-password":case"auth/invalid-email":return"Email o contrase\xF1a incorrectos";case"auth/too-many-requests":return"Demasiados intentos. Intente m\xE1s tarde";case"auth/invalid-credential":return"Credenciales inv\xE1lidas";case"auth/email-already-in-use":return"Email ya en uso";case"auth/weak-password":return"Contrase\xF1a d\xE9bil";default:return"Error desconocido"}}static \u0275fac=function(r){return new(r||o)(s(g),s(p),s(m),s(U))};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();export{U as a,F as b};
