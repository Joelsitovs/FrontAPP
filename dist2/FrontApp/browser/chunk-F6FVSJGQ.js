import{a as A}from"./chunk-4DSCY4QZ.js";import{a as F}from"./chunk-4QNLY54V.js";import{a as N,b as c,c as T,d as D,g as U,h as q,i as j,n as z,p as M}from"./chunk-5GBPBMV7.js";import{b as R}from"./chunk-HKWKQJZR.js";import"./chunk-FWOJAUMH.js";import{$ as C,Ha as I,Ia as w,R as E,S as o,U as v,V as y,Z as s,a as b,aa as a,b as _,da as n,ea as r,f as S,fa as u,ga as f,ha as g,ja as x,ka as p,oa as l,qa as h}from"./chunk-74CKK67D.js";function G(e,d){e&1&&(n(0,"div",25)(1,"p"),l(2,"El nombre es requerido"),r()())}function P(e,d){e&1&&(f(0),n(1,"p"),l(2,"El DNI es requerido."),r(),g())}function V(e,d){e&1&&(f(0),n(1,"p"),l(2,"El DNI debe tener al menos 6 caracteres."),r(),g())}function $(e,d){e&1&&(f(0),n(1,"p"),l(2,"El DNI no puede tener m\xE1s de 15 caracteres."),r(),g())}function B(e,d){e&1&&(f(0),n(1,"p"),l(2,"Solo se permiten letras y n\xFAmeros (sin s\xEDmbolos)."),r(),g())}function O(e,d){if(e&1&&(n(0,"div",26),s(1,P,3,0,"ng-container",27)(2,V,3,0,"ng-container",27)(3,$,3,0,"ng-container",27)(4,B,3,0,"ng-container",27),r()),e&2){let t=p();o(),a("ngIf",t.dni.errors==null?null:t.dni.errors.required),o(),a("ngIf",t.dni.errors==null?null:t.dni.errors.minlength),o(),a("ngIf",t.dni.errors==null?null:t.dni.errors.maxlength),o(),a("ngIf",t.dni.errors==null?null:t.dni.errors.pattern)}}function Z(e,d){e&1&&(n(0,"p",30),l(1," El email es obligatorio "),r())}function H(e,d){e&1&&(n(0,"p",30),l(1,"El email no es v\xE1lido"),r())}function J(e,d){if(e&1&&(n(0,"div",28),s(1,Z,2,0,"p",29)(2,H,2,0,"p",29),r()),e&2){let t=p();o(),a("ngIf",t.email==null||t.email.errors==null?null:t.email.errors.required),o(),a("ngIf",t.email==null||t.email.errors==null?null:t.email.errors.email)}}function K(e,d){e&1&&(n(0,"div",25),l(1," La fecha es requerida "),r())}function Q(e,d){e&1&&(n(0,"div",25),l(1," La fecha no puede ser mayor a la fecha actual "),r())}function W(e,d){if(e&1&&u(0,"img",31),e&2){let t=p();a("src",t.previewUrl,E)}}function X(e,d){if(e&1&&(n(0,"div",32),l(1),r()),e&2){let t=p();o(),h(" ",t.respuesta,`
`)}}function Y(e,d){if(e&1&&(n(0,"div",33),l(1),r()),e&2){let t=p();o(),h(" ",t.respuestaError,`
`)}}var fe=(()=>{class e{fb;authService;userService;imagenSeleccionada=null;previewUrl=null;uid=null;maxFecha;onFileSelected(t){let m=t.target;if(m.files&&m.files.length>0){this.imagenSeleccionada=m.files[0];let i=new FileReader;i.onload=()=>{this.previewUrl=i.result},i.readAsDataURL(this.imagenSeleccionada)}}form;constructor(t,m,i){this.fb=t,this.authService=m,this.userService=i,this.form=this.fb.group({nombre:["",[c.required]],dni:["",[c.required,c.minLength(6),c.maxLength(15),c.pattern("^[a-zA-Z0-9]+$")]],email:["",[c.required,c.email]],fecha_nacimiento:["",[c.required,this.fechaFutura]]})}fechaFutura(t){return new Date(t.value)>new Date?{fechaFutura:!0}:null}get nombre(){return this.form.get("nombre")}get dni(){return this.form.get("dni")}get email(){return this.form.get("email")}get fecha_nacimiento(){return this.form.get("fecha_nacimiento")}respuesta="";respuestaError="";formatoFecha(t){return t.replace(/-/g,"/")}ngOnInit(){this.uid=localStorage.getItem("uid"),this.maxFecha=new Date().toISOString().split("T")[0]}onSubmit(){return S(this,null,function*(){if(this.form.valid){let t=_(b({},this.form.value),{foto_perfil:this.previewUrl??null,created_by:this.uid});this.userService.register(t).subscribe({next:m=>{console.log("Usuario creado:",m),this.respuesta="Usuario registrado correctamente",this.imagenSeleccionada&&this.userService.uploadImagenPerfil(this.form.value.dni,this.imagenSeleccionada).subscribe({next:i=>{console.log("Imagen subida:",i)},error:i=>{console.error("Error al subir imagen:",i),this.respuestaError="Error al subir imagen"},complete:()=>{console.log("Subida de imagen completada")}}),this.clearMessages(),this.form.reset(),this.previewUrl=null},error:m=>{this.respuestaError=m?.error?.detail?.[0]?.msg?.replace(/^"(.*)"$/,"$1")||"Error al registrar usuario",console.error("Error:",this.respuestaError),this.clearMessages()},complete:()=>{console.log("Registro completado")}})}})}clearMessages(){setTimeout(()=>{this.respuesta="",this.respuestaError=""},4e3)}static \u0275fac=function(m){return new(m||e)(v(z),v(R),v(A))};static \u0275cmp=y({type:e,selectors:[["app-registro"]],decls:37,vars:11,consts:[["id","Inicio",1,"w-full","min-h-screen","flex","flex-col","sm:flex-row","items-center","justify-center","pt-16","px-4","overflow-hidden","border-none"],[1,"flex","flex-col","items-center","justify-center","w-80"],[1,"flex","flex-col","w-full","items-center","justify-center","gap-10",3,"ngSubmit","formGroup"],[1,"relative","w-full","flex","flex-col","gap-2"],["for","Nombre",1,"text-sm","text-gray-400","flex","items-start"],["type","text","formControlName","nombre",1,"w-full","border","border-[#161616]","rounded-md","p-2","focus:ring-0"],["class","text-red-500 text-base",4,"ngIf"],["for","dni",1,"text-sm","text-gray-500","mb-1","block"],["type","text","formControlName","dni",1,"w-full","border","border-[#161616]","rounded-md","p-2","focus:ring-0"],["class","text-red-500 text-base mt-1",4,"ngIf"],["for","email",1,"text-sm","text-gray-400","flex","items-start"],["type","email","formControlName","email",1,"w-full","border","border-[#161616]","rounded-md","p-2","focus:ring-0"],["class","text-base text-red-500",4,"ngIf"],[1,"flex","justify-between","w-full"],["for","date",1,"text-sm","dark:text-gray-400"],[1,"relative","w-full"],["type","date","formControlName","fecha_nacimiento",1,"w-full","border","border-[#161616]","rounded-md","p-2","focus:ring-0"],[1,"mb-4","w-full"],["for","foto",1,"block","text-sm","font-medium","text-gray-700","mb-1","dark:text-gray-400"],[1,"flex","items-center","gap-4","flex-col"],["alt","Previsualizaci\xF3n","class","w-12 h-12 rounded-full object-cover border",3,"src",4,"ngIf"],["id","foto","type","file","accept","image/*",1,"block","w-full","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded-md","file:border-0","file:text-sm","file:font-semibold","file:bg-blue-50","file:text-blue-700","hover:file:bg-blue-100",3,"change"],["type","submit",1,"bg-blue-500","hover:bg-blue-600","text-white","text-sm","font-bold","py-2","px-4","w-full","rounded-md","transition","disabled:bg-gray-300",3,"disabled"],["class","fixed top-20 left-0 z-50 bg-green-500 text-white px-6 py-3 rounded-r-md shadow-md border-l-4 border-green-700 animate-slide-in",4,"ngIf"],["class","fixed top-20 left-0 z-50 bg-red-500 text-white px-6 py-3 rounded-r-md shadow-md border-l-4 border-red-700 animate-slide-in",4,"ngIf"],[1,"text-red-500","text-base"],[1,"text-red-500","text-base","mt-1"],[4,"ngIf"],[1,"text-base","text-red-500"],["class","",4,"ngIf"],[1,""],["alt","Previsualizaci\xF3n",1,"w-12","h-12","rounded-full","object-cover","border",3,"src"],[1,"fixed","top-20","left-0","z-50","bg-green-500","text-white","px-6","py-3","rounded-r-md","shadow-md","border-l-4","border-green-700","animate-slide-in"],[1,"fixed","top-20","left-0","z-50","bg-red-500","text-white","px-6","py-3","rounded-r-md","shadow-md","border-l-4","border-red-700","animate-slide-in"]],template:function(m,i){m&1&&(u(0,"app-navigation"),n(1,"section",0)(2,"div",1)(3,"form",2),x("ngSubmit",function(){return i.onSubmit()}),n(4,"div",3)(5,"label",4),l(6,"Nombre"),r(),u(7,"input",5),s(8,G,3,0,"div",6),r(),n(9,"div",3)(10,"label",7),l(11," DNI / NIE / Pasaporte "),r(),u(12,"input",8),s(13,O,5,4,"div",9),r(),n(14,"div",3)(15,"label",10),l(16,"Correo"),r(),u(17,"input",11),s(18,J,3,2,"div",12),r(),n(19,"div",3)(20,"div",13)(21,"label",14),l(22," Fecha de Nacimiento "),r()(),n(23,"div",15),u(24,"input",16),r(),s(25,K,2,0,"div",6)(26,Q,2,0,"div",6),r(),n(27,"div",17)(28,"label",18),l(29," Foto de perfil "),r(),n(30,"div",19),s(31,W,1,1,"img",20),n(32,"input",21),x("change",function(L){return i.onFileSelected(L)}),r()()(),n(33,"button",22),l(34," Registrar Usuario "),r()()()(),s(35,X,2,1,"div",23)(36,Y,2,1,"div",24)),m&2&&(o(3),a("formGroup",i.form),o(5),a("ngIf",i.nombre.invalid&&i.nombre.touched),o(5),a("ngIf",i.dni.invalid&&i.dni.touched),o(5),a("ngIf",i.email.invalid&&i.email.touched),o(6),C("max",i.maxFecha),o(),a("ngIf",i.fecha_nacimiento.hasError("required")&&i.fecha_nacimiento.touched),o(),a("ngIf",i.fecha_nacimiento.hasError("fechaFutura")&&i.fecha_nacimiento.touched),o(5),a("ngIf",i.previewUrl),o(2),a("disabled",i.form.invalid),o(2),a("ngIf",i.respuesta),o(),a("ngIf",i.respuestaError))},dependencies:[w,I,M,U,N,T,D,q,j,F],encapsulation:2})}return e})();export{fe as RegistroComponent};
