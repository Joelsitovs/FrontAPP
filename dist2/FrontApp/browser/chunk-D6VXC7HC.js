import{a as N}from"./chunk-DRI2ZTZB.js";import{a as M}from"./chunk-4DSCY4QZ.js";import{a as F}from"./chunk-4QNLY54V.js";import{a as T,b as c,c as U,d as z,g as D,h as V,i as q,n as R,p as j}from"./chunk-5GBPBMV7.js";import"./chunk-HKWKQJZR.js";import"./chunk-FWOJAUMH.js";import{$ as y,F as x,G as v,Ha as C,Ia as I,Pa as w,R as b,S as a,U as f,V as E,Z as s,aa as l,da as n,ea as r,fa as u,ia as S,ja as g,ka as p,oa as d,qa as _}from"./chunk-74CKK67D.js";function P(t,m){t&1&&(n(0,"h2",7),d(1," Editar Usuario "),r())}function A(t,m){t&1&&(n(0,"div"),d(1,"Cargando datos del usuario..."),r())}function G(t,m){t&1&&(n(0,"div",24)(1,"p"),d(2,"El nombre es requerido"),r()())}function L(t,m){t&1&&(n(0,"div",24)(1,"p"),d(2,"El DNI / NIE / Pasaporte es requerido"),r()())}function B(t,m){t&1&&(n(0,"p"),d(1,"El correo es requerido"),r())}function k(t,m){t&1&&(n(0,"p"),d(1,"El correo no es v\xE1lido"),r())}function O(t,m){if(t&1&&(n(0,"div",24),s(1,B,2,0,"p",3)(2,k,2,0,"p",3),r()),t&2){let e=p(2);a(),l("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.required),a(),l("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.email)}}function Z(t,m){t&1&&(n(0,"div",24),d(1," La fecha es requerida "),r())}function $(t,m){t&1&&(n(0,"div",24),d(1," La fecha no puede ser mayor a la fecha actual "),r())}function H(t,m){if(t&1&&u(0,"img",25),t&2){let e=p(2);l("src",e.previewUrl,b)}}function J(t,m){if(t&1){let e=S();n(0,"div",8)(1,"form",9),g("ngSubmit",function(){x(e);let i=p();return v(i.guardarCambios())}),n(2,"div",10)(3,"label",11),d(4,"Nombre"),r(),u(5,"input",12),s(6,G,3,0,"div",13),r(),n(7,"div",10)(8,"label",14),d(9," DNI / NIE / Pasaporte "),r(),u(10,"input",15),s(11,L,3,0,"div",13),r(),n(12,"div",10)(13,"label",16),d(14,"Correo"),r(),u(15,"input",17),s(16,O,3,2,"div",13),r(),n(17,"div",10)(18,"label",18),d(19," Fecha de Nacimiento "),r(),u(20,"input",19),s(21,Z,2,0,"div",13)(22,$,2,0,"div",13),r(),n(23,"div",20),s(24,H,1,1,"img",21),n(25,"input",22),g("change",function(i){x(e);let h=p();return v(h.onFileSelected(i))}),r()(),n(26,"button",23),d(27,"Guardar"),r()(),u(28,"div"),r()}if(t&2){let e=p();a(),l("formGroup",e.form),a(5),l("ngIf",e.nombre.invalid&&e.nombre.touched),a(5),l("ngIf",e.dni.invalid&&e.dni.touched),a(5),l("ngIf",e.email.invalid&&e.email.touched),a(4),y("max",e.maxFecha),a(),l("ngIf",e.fecha_nacimiento.hasError("required")&&e.fecha_nacimiento.touched),a(),l("ngIf",e.fecha_nacimiento.hasError("fechaFutura")),a(2),l("ngIf",e.previewUrl),a(2),l("disabled",e.form.invalid)}}function K(t,m){if(t&1&&(n(0,"div",26),d(1),r()),t&2){let e=p();a(),_(" ",e.respuesta,`
`)}}function Q(t,m){if(t&1&&(n(0,"div",27),d(1),r()),t&2){let e=p();a(),_(" ",e.respuestaError,`
`)}}var me=(()=>{class t{fb;userService;route;cargando=!1;form;id="";fechaParaInputDate="";imagenSeleccionada=null;previewUrl=null;usuario={};respuesta="";respuestaError="";maxFecha="";constructor(e,o,i){this.fb=e,this.userService=o,this.route=i,this.form=this.fb.group({nombre:["",[c.required]],dni:["",[c.required,c.minLength(6),c.maxLength(15),c.pattern("^[a-zA-Z0-9]+$")]],email:["",[c.required,c.email]],fecha_nacimiento:["",[c.required,this.fechaFutura]],foto_perfil:[""]})}fechaFutura(e){return new Date(e.value)>new Date?{fechaFutura:!0}:null}get nombre(){return this.form.get("nombre")}get dni(){return this.form.get("dni")}get email(){return this.form.get("email")}get fecha_nacimiento(){return this.form.get("fecha_nacimiento")}ngOnInit(){this.maxFecha=new Date().toISOString().split("T")[0],this.route.paramMap.subscribe(e=>{this.id=e.get("dni"),this.cargarUsuario(this.id)})}cargarUsuario(e){this.cargando=!0,this.userService.getUserById(e).subscribe({next:o=>{console.log(o);let i=o.data;this.form.patchValue({nombre:i.nombre,dni:i.dni,email:i.email,fecha_nacimiento:i.fecha_nacimiento,foto_perfil:i.foto_perfil}),this.previewUrl=i.foto_perfil??null,this.usuario=i,this.cargando=!1},error:o=>{console.error("Error al cargar usuario:",o),this.cargando=!1}})}onFileSelected(e){let o=e.target;if(o.files&&o.files.length>0){this.imagenSeleccionada=o.files[0];let i=new FileReader;i.onload=()=>{this.previewUrl=i.result,this.form.patchValue({foto_perfil:i.result})},i.readAsDataURL(this.imagenSeleccionada)}}guardarCambios(){let e=this.form.value;if(e.nombre===this.usuario.nombre&&e.dni===this.usuario.dni&&e.email===this.usuario.email&&e.fecha_nacimiento===this.usuario.fecha_nacimiento&&e.foto_perfil===this.usuario.foto_perfil&&!this.imagenSeleccionada){this.respuestaError="No se han realizado cambios",this.clearRespuesta();return}this.imagenSeleccionada?this.userService.uploadImagenPerfil(this.id,this.imagenSeleccionada).subscribe({next:i=>{console.log("Imagen subida:");let h=i.url;this.form.controls.foto_perfil.setValue(h),this.enviarFormulario()},error:i=>{console.error(" Error al subir imagen:",i),this.respuestaError="Error al subir imagen",this.clearRespuesta()}}):this.enviarFormulario()}enviarFormulario(){this.userService.editUser(this.id,this.form.value).subscribe({next:e=>{console.log(" Usuario actualizado:",e),this.respuesta="Usuario actualizado correctamente",this.clearRespuesta()},error:e=>{console.error(" Error al actualizar usuario:",e),this.respuestaError="Error al actualizar usuario",this.clearRespuesta()}})}clearRespuesta(){setTimeout(()=>{this.respuesta="",this.respuestaError=""},3e3)}static \u0275fac=function(o){return new(o||t)(f(R),f(M),f(w))};static \u0275cmp=E({type:t,selectors:[["app-edit"]],decls:8,vars:5,consts:[["id","Inicio",1,"w-full","min-h-screen","flex","flex-col","sm:flex-row","items-center","justify-center","pt-16","px-4","overflow-hidden","border-none"],[1,"flex","flex-col","items-center","justify-center","w-80"],["class","text-2xl font-bold mb-4",4,"ngIf"],[4,"ngIf"],["class","flex flex-col gap-4 items-center",4,"ngIf"],["class","fixed top-20 left-0 z-50 bg-green-500 text-white px-6 py-3 rounded-r-md shadow-md border-l-4 border-green-700 animate-slide-in",4,"ngIf"],["class","fixed top-20 left-0 z-50 bg-red-500 text-white px-6 py-3 rounded-r-md shadow-md border-l-4 border-red-700 animate-slide-in",4,"ngIf"],[1,"text-2xl","font-bold","mb-4"],[1,"flex","flex-col","gap-4","items-center"],["action","",1,"flex","flex-col","gap-4","w-90",3,"ngSubmit","formGroup"],[1,"relative","w-full","flex","flex-col","gap-2"],["for","Nombre",1,"text-sm","text-gray-500","flex","items-start"],["type","text","placeholder","Nombre","formControlName","nombre",1,"border","px-4","py-2","rounded","shadow"],["class","text-red-500 text-base",4,"ngIf"],["for","dni",1,"text-sm","text-gray-500","mb-1","block"],["type","text","placeholder","DNI","formControlName","dni",1,"border","px-4","py-2","rounded","shadow"],["for","email",1,"text-sm","text-gray-500","flex","items-start"],["type","email","placeholder","Email","formControlName","email",1,"border","px-4","py-2","rounded","shadow"],["for","date",1,"text-sm","text-gray-500"],["type","date","formControlName","fecha_nacimiento",1,"border","px-4","py-2","rounded","shadow"],[1,"flex","items-center","gap-4","flex-col"],["alt","Previsualizaci\xF3n","class","w-12 h-12 rounded-full object-cover border",3,"src",4,"ngIf"],["id","foto","type","file","accept","image/*",1,"block","w-full","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded-md","file:border-0","file:text-sm","file:font-semibold","file:bg-blue-50","file:text-blue-700","hover:file:bg-blue-100",3,"change"],[3,"disabled"],[1,"text-red-500","text-base"],["alt","Previsualizaci\xF3n",1,"w-12","h-12","rounded-full","object-cover","border",3,"src"],[1,"fixed","top-20","left-0","z-50","bg-green-500","text-white","px-6","py-3","rounded-r-md","shadow-md","border-l-4","border-green-700","animate-slide-in"],[1,"fixed","top-20","left-0","z-50","bg-red-500","text-white","px-6","py-3","rounded-r-md","shadow-md","border-l-4","border-red-700","animate-slide-in"]],template:function(o,i){o&1&&(u(0,"app-navigation"),n(1,"section",0)(2,"div",1),s(3,P,2,0,"h2",2)(4,A,2,0,"div",3)(5,J,29,9,"div",4),r()(),s(6,K,2,1,"div",5)(7,Q,2,1,"div",6)),o&2&&(a(3),l("ngIf",i.usuario&&!i.cargando),a(),l("ngIf",i.cargando),a(),l("ngIf",i.usuario&&!i.cargando),a(),l("ngIf",i.respuesta),a(),l("ngIf",i.respuestaError))},dependencies:[I,C,N,F,j,D,T,U,z,V,q],encapsulation:2})}return t})();export{me as EditComponent};
